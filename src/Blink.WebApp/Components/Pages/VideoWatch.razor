@attribute [Authorize]
@attribute [StreamRendering]
@page "/videos/watch/{BlobName}"

<PageTitle>@(Video != null ? GetDisplayTitle(Video) : "Watch Video")</PageTitle>

<div class="container mt-4">
    @if (IsLoadingVideo)
    {
        <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading video...</span>
            </div>
            <p class="mt-3">Loading video...</p>
        </div>
    }
    else if (!string.IsNullOrEmpty(ErrorMessage))
    {
        <div class="alert alert-danger" role="alert">
            <strong>Error!</strong> @ErrorMessage
        </div>
        <div class="text-center">
            <a class="btn btn-primary" href="/videos">
                <span class="bi bi-arrow-left"></span> Back to Videos
            </a>
        </div>
    }
    else if (Video != null)
    {
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <div class="mb-3">
                    <a class="btn btn-outline-secondary" href="/videos">
                        <span class="bi bi-arrow-left"></span> Back to Videos
                    </a>
                </div>
                
                <div class="card shadow-sm">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h3 class="mb-0">@GetDisplayTitle(Video)</h3>
                                <small class="text-muted">
                                    @FormatFileSize(Video.SizeInBytes) â€¢
                                    @(Video.LastModified?.LocalDateTime.ToString("g") ?? "Unknown")
                                </small>
                            </div>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        @if (!string.IsNullOrEmpty(CurrentVideoUrl))
                        {
                            <div class="ratio ratio-16x9">
                                <video controls autoplay preload="metadata" class="w-100">
                                    <source src="@CurrentVideoUrl" type="@Video.ContentType">
                                    Your browser does not support the video tag.
                                </video>
                            </div>
                            <div class="p-3">
                                <small class="text-muted">If the video doesn't play, try clicking the play button.</small>
                            </div>
                        }
                    </div>
                    <div class="card-footer">
                        <div class="row">
                            <div class="col-md-6">
                                <small class="text-muted">
                                    <strong>File:</strong> @Video.FileName
                                </small>
                            </div>
                            <div class="col-md-6 text-md-end">
                                <small class="text-muted">
                                    <strong>Type:</strong> @Video.ContentType
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
</div>
