@page "/"
@attribute [Authorize]
@attribute [StreamRendering]

@using Blink.Web.Components.Pages.Home.Components

<PageTitle>Home</PageTitle>

<section class="mb-8">
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-bold dark:text-white">Blink Home Videos</h1>
            <p class="text-gray-600 dark:text-gray-300 mt-2">Organize, back up, and share your family's favorite moments.</p>
        </div>
        <FeatureGate FeatureName="@FeatureFlags.Uploads">
            <a href="/upload" class="px-6 py-3 rounded-lg bg-blue-600 text-white font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors flex items-center gap-2">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-5 h-5">
                    <path d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                <span>Upload Video</span>
            </a>
        </FeatureGate>
    </div>
</section>

<FeatureGate FeatureName="@FeatureFlags.GlobalSearch">
    <section class="mb-8">
        <div class="flex flex-wrap gap-3 items-center">
            <div class="flex-1 min-w-[260px]">
                <div class="relative">
                    <input class="w-full border border-gray-300 dark:border-gray-700 rounded-lg pl-10 pr-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400" placeholder="Search titles, people, places…" />
                    <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 dark:text-gray-500">🔎</div>
                </div>
            </div>
            <div class="flex gap-2 flex-wrap">
                <button class="px-3 py-1.5 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200">All</button>
                <button class="px-3 py-1.5 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200">Family</button>
                <button class="px-3 py-1.5 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200">Trips</button>
                <button class="px-3 py-1.5 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200">Kids</button>
                <button class="px-3 py-1.5 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200">2025</button>
                <button class="px-3 py-1.5 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200">Favorites</button>
            </div>
        </div>
    </section>
</FeatureGate>

<FeatureGate FeatureName="@FeatureFlags.ContinueWatching">
    <section class="mb-10">
        <h2 class="text-xl font-semibold mb-3 dark:text-white">Continue watching</h2>
        <div class="overflow-x-auto">
            <ul class="flex gap-4 min-w-max">
                <li class="w-64 flex-shrink-0">
                    <div class="border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-900">
                        <div class="bg-gray-100 dark:bg-gray-800 h-36 relative">
                            <div class="absolute right-2 bottom-2 text-xs px-2 py-1 rounded bg-black/70 text-white">12:34</div>
                            <div class="absolute inset-0 flex items-center justify-center text-gray-500 dark:text-gray-400">▶️</div>
                        </div>
                        <div class="p-3">
                            <div class="font-medium truncate text-gray-900 dark:text-gray-100">Summer Road Trip Day 3</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">Last watched 02:18</div>
                        </div>
                    </div>
                </li>
                <li class="w-64 flex-shrink-0">
                    <div class="border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-900">
                        <div class="bg-gray-100 dark:bg-gray-800 h-36 relative">
                            <div class="absolute right-2 bottom-2 text-xs px-2 py-1 rounded bg-black/70 text-white">08:05</div>
                            <div class="absolute inset-0 flex items-center justify-center text-gray-500 dark:text-gray-400">▶️</div>
                        </div>
                        <div class="p-3">
                            <div class="font-medium truncate text-gray-900 dark:text-gray-100">Luca’s First Steps</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">Last watched 00:47</div>
                        </div>
                    </div>
                </li>
                <li class="w-64 flex-shrink-0">
                    <div class="border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-900">
                        <div class="bg-gray-100 dark:bg-gray-800 h-36 relative">
                            <div class="absolute right-2 bottom-2 text-xs px-2 py-1 rounded bg-black/70 text-white">21:10</div>
                            <div class="absolute inset-0 flex items-center justify-center text-gray-500 dark:text-gray-400">▶️</div>
                        </div>
                        <div class="p-3">
                            <div class="font-medium truncate text-gray-900 dark:text-gray-100">Grandma’s 80th Birthday</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">Last watched 10:02</div>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </section>
</FeatureGate>

<FeatureGate FeatureName="@FeatureFlags.Collections">
    <section class="mb-10">
        <div class="flex items-center justify-between mb-3">
            <h2 class="text-xl font-semibold dark:text-white">Collections</h2>
            <a class="text-sm text-blue-600 dark:text-blue-400 hover:underline" href="#">View all</a>
        </div>
        <div class="grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3">
            <a href="#" class="block border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-white dark:bg-gray-900 hover:shadow">
                <div class="flex items-center justify-between">
                    <div class="font-medium text-gray-900 dark:text-gray-100">Family</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">128 videos</div>
                </div>
                <div class="mt-3 text-sm text-gray-600 dark:text-gray-300">Vacations, birthdays, and everyday moments.</div>
            </a>
            <a href="#" class="block border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-white dark:bg-gray-900 hover:shadow">
                <div class="flex items-center justify-between">
                    <div class="font-medium text-gray-900 dark:text-gray-100">Kids</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">86 videos</div>
                </div>
                <div class="mt-3 text-sm text-gray-600 dark:text-gray-300">Milestones, school plays, and sports.</div>
            </a>
            <a href="#" class="block border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-white dark:bg-gray-900 hover:shadow">
                <div class="flex items-center justify-between">
                    <div class="font-medium text-gray-900 dark:text-gray-100">Trips</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">42 videos</div>
                </div>
                <div class="mt-3 text-sm text-gray-600 dark:text-gray-300">Weekend getaways and long adventures.</div>
            </a>
        </div>
    </section>
</FeatureGate>

<FeatureGate FeatureName="@FeatureFlags.RecentUploads">
    <section class="mb-12">
        <h2 class="text-xl font-semibold dark:text-white mb-3">Recent uploads</h2>
        <RecentlyUploadedDataContext Context="videos">
            <div class="grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6">
                @foreach (var video in videos)
                {
                    <a href="video/@video.Id" class="border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-900">
                        <div class="bg-gray-100 dark:bg-gray-800 h-50 relative">
                            @if (!string.IsNullOrWhiteSpace(video.DurationDisplayText))
                            {
                                <div class="absolute right-1 bottom-1 text-xs px-2 py-1 rounded bg-black/70 text-white">
                                    @video.DurationDisplayText
                                </div>
                            }
                            @if (!string.IsNullOrWhiteSpace(video.ThumbnailUrl))
                            {
                                <img src="@video.ThumbnailUrl" alt="Thumbnail" class="object-cover w-full h-full" />
                            }
                            else
                            {
                                <div class="absolute inset-0 flex items-center justify-center text-gray-500 dark:text-gray-400 text-4xl">🎬</div>
                            }
                        </div>
                        <div class="p-3">
                            <div class="font-medium truncate text-gray-900 dark:text-gray-100">@video.Title</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">@video.UploadedAt.ToLocalTime().ToString("M/d/yyyy h:mm tt") • @video.SizeDisplayText</div>
                            @*<div class="mt-3 flex gap-2">
                            <a href="@urls?.Url" class="px-3 py-1.5 rounded bg-blue-600 text-white text-sm">Play</a>
                            <button class="px-3 py-1.5 rounded border border-gray-300 dark:border-gray-700 dark:text-gray-200 text-sm">Share</button>
                            <button class="px-3 py-1.5 rounded border border-gray-300 dark:border-gray-700 dark:text-gray-200 text-sm">Download</button>
                        </div>*@
                        </div>
                    </a>
                }
            </div>
        </RecentlyUploadedDataContext>
    </section>

</FeatureGate>

<FeatureGate FeatureName="@FeatureFlags.SharedWithMe">
    <section class="mb-16">
        <h2 class="text-xl font-semibold mb-3 dark:text-white">Shared with me</h2>
        <ul class="divide-y divide-gray-200 dark:divide-gray-800 border dark:border-gray-700 rounded-lg bg-white dark:bg-gray-900">
            <li class="p-4 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-700 dark:bg-indigo-900 dark:text-indigo-300 flex items-center justify-center text-sm">EM</div>
                    <div>
                        <div class="font-medium text-gray-900 dark:text-gray-100">McLaughlin Family Folder</div>
                        <div class="text-xs text-gray-500 dark:text-gray-400">Shared by Erin • 24 items</div>
                    </div>
                </div>
                <button class="px-3 py-1.5 rounded border border-gray-300 dark:border-gray-700 dark:text-gray-200 text-sm">Open</button>
            </li>
            <li class="p-4 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-amber-100 text-amber-700 dark:bg-amber-900 dark:text-amber-300 flex items-center justify-center text-sm">JS</div>
                    <div>
                        <div class="font-medium text-gray-900 dark:text-gray-100">Soccer Team Highlights</div>
                        <div class="text-xs text-gray-500 dark:text-gray-400">Shared by Jordan • 12 videos</div>
                    </div>
                </div>
                <button class="px-3 py-1.5 rounded border border-gray-300 dark:border-gray-700 dark:text-gray-200 text-sm">Open</button>
            </li>
        </ul>
    </section>
</FeatureGate>
