@using Blink.Storage
@inject IVideoStorageClient StorageClient

<a href="video/@Video.Id" class="border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-900">
    <div class="bg-gray-100 dark:bg-gray-800 h-50 relative">
        @if (Video.GetDurationDisplayText() is { Length: > 0 } durationText)
        {
            <div class="absolute right-1 bottom-1 text-xs px-2 py-1 rounded bg-black/70 text-white">
                @durationText
            </div>
        }
        @if (!string.IsNullOrWhiteSpace(ThumbnailUrl))
        {
            <img src="@ThumbnailUrl" alt="Thumbnail" class="object-cover w-full h-full" />
        }
        else
        {
            <div class="absolute inset-0 flex items-center justify-center text-gray-500 dark:text-gray-400 text-4xl">🎬</div>
        }
    </div>
    <div class="p-3">
        <div class="font-medium truncate text-gray-900 dark:text-gray-100">@Video.Title</div>
        <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">@Video.UploadedAt.ToLocalTime().ToString("M/d/yyyy h:mm tt") • @Video.GetSizeDisplayText()</div>
    </div>
</a>

@code {

    private string? ThumbnailUrl { get; set; }

    [Parameter, EditorRequired]
    public required RecentlyUploadedVideoVm Video { get; set; }

    protected override async Task OnInitializedAsync()
    {
        if (Video.ThumbnailBlobName is not null)
        {
            ThumbnailUrl = await StorageClient.GetThumbnailUrlAsync(Video.ThumbnailBlobName);
        }
    }
}
